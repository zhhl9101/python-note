# 装饰器，你装饰了我的梦

<p align="right">2021年8月，时间结余。</p>

---

## 1. 问题

一个求和函数如下：

```python
def summary(num1, num2):
    sum = num1 + num2
    return sum

sum = summary(1, 3) #调用函数
```

现在我想知道这个函数执行的过程用了多长时间，改进一下：

```python
import time

def summary(num1, num2):
    start = time.time()
    sum = num1 + num2
    end = time.time()
    print("time costs:",end - start)
    return sum

sum = summary(1, 3) #调用函数
```

调用一下，`summary(13, 14)`，输出为：`time costs: 0.0` ，简直不要太完美~~

可是问题来了：**现在有若干个函数，我想输出所有函数的执行时间。**

难道要一个一个的改函数吗？这是不科学的！

我们可以考虑重新定义一个函数`process_time`来给函数计时。

```python
import time

def summary(num1, num2):
    sum = num1 + num2
    return sum

def process_time(func, num1, num2):
    start = time.time()
    func(num1, num2)
    end = time.time()
    print("time costs:", end - start)

sum = process_time(summary, 1, 3) #调用函数开始执行
```

将函数名字（引用）作为参数传入函数`process_time`来。这样就完美解决了需要修改`summary`内部代码的问题。

但是这样还有问题：**如果`summary`在若干个函数里被调用，我想知道这若干个函数里`summary`函数执行的时间。**

那现在我需要到这若干个函数体里给`summary`加上`process_time`。岂不是很麻烦？

有人说这种场景实际情况中很少会遇到，不需要这么复杂。我后面会说到这个问题。

更优雅的做法：

```python
import time

def summary(num1, num2):
    sum = num1 + num2
    return sum

def process_time(func):
    def wrapper(num1, num2):
        start = time.time()
        sum = func(num1, num2)
        end = time.time()
        print("time costs:", end - start)
        return sum
    return wrapper

summary = process_time(summary)
sum = summary(1, 3)   #调用函数
```

这种做法没有修改原来的代码，只增加了若干代码。岂不是很优雅！

这就是一个简单的**装饰器**了。`process_time`就是一个装饰者，装饰了`summary`函数。

---

## 2. 装饰器

Python提供了一个语法糖来实现装饰行为：

```python
import time

def process_time(func):
    def wrapper(num1, num2):
        start = time.time()
        sum = func(num1, num2)
        end = time.time()
        print("time costs:", end - start)
        return sum
    return wrapper

@process_time
def summary(num1, num2):
    sum = num1 + num2
    return sum

sum = summary(1, 3)   #调用函数
```

这就是装饰器：

如果要增强func函数的功能，但不改变func函数的代码，可以在执行func函数的时候，通过装饰器给函数增强功能。

本质上，装饰器就是一个返回值为函数的高阶函数。

---

## 3. 应用场景

